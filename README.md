# movinglight-js

ムービングライトをnodejsで制御する

## 概要
scenesフォルダに、jsで記述されたスクリプトを書く。

oscサーバーに発火したいsceneを知らせると、sceneスクリプトに応じて、oscまたはdmx信号を送付して、ムービングライトを制御する。

## todo
- [x] scene function の設計。return するのか、thisに書くのか 判断 [2016/10/30 (日) 13:17]
  - movingライトやdmxを送れるclassをrequireするのが賢いと思う
- [x] sceneの外部ファイル化 [2016/10/30 (日) 11:38]
  まずは組み込み関数とか抜きで、普通に外部化して読み込もう
- [x] oscでファイル名を指定して発火 [2016/10/30 (日) 11:38]
- [x] node-serialportを試す →残念ならがbaudRateがだめ [2016/10/30 (日) 16:08]
- [x] Scene クラスの時間周りを整えた。atとか実装できたのは良い [2016/10/30 (日) 19:15]
- [ ] osc <==> jsonオブジェクトのやつをすすめる
- [ ] loop once のもーどをいれる
- [ ] 外部変数を流せるようにする（設計を考える
- [ ] scene共通関数やモジュールをインポートする仕組みを考える
  - たぶんムスターシュで繰り返しをすると良い
- [ ] sceneのエラーをちゃんとキャッチする

こっちの２つが優先順位高い
- [ ] MovingLight class を作る
  - [ ] init 縦横比
  - [ ] pointAt 数値とfloat
  - [ ] setBrightness
  - [ ] setColor
  - [ ] setDimmer
  - [ ] setGobo
- [ ] 四角形のマップをするclassを作る
  - [ ] apiの設計
  - [ ] 行列計算
    - [ ] dmx値をradianに変換
    - [ ] radianからz=どこか(1だろうか)でdst pointを計算
    - [x] srcは0~1または比率を持った四角形として、matを計算 [2016/11/05 (土) 22:05]
    - [ ] 値が得られたら、そこを与えるようなradianを得る（逆の計算すればok
- [ ] 特定の値をjsonで即保存　＆　関数から呼び出し　はあると良いかも。上のマッピングソフトとは別モジュールになりそう

- [ ] build.js
  - [x] mustacheを使って、src/beforeを付け足して、dstファイルとして出力 [2016/10/30 (日) 17:15]
  - [x] config.json にport番号とか入れたい [2016/10/30 (日) 17:20]
  - [x] requireキャッシュを消して、リロードに成功 [2016/10/31 (月) 03:32]
  - [ ] ファイル保存時に自動build

- [ ] oscのqlcファイルを作る

- 関数群
  - sendDmx(ch, val);
  - MovingObject Class
    - setColor
    - setDimmer
    - setPan, setTilt
    - 

## future
スクリプトの変更の自動検知→発火
複数スクリプトの並行処理（ムービングを一度に全部制御するのではなく、別ファイルにしたり、しなかったりを楽にできるようにする）
外部変数の読込（oscでリアルタイムに送られてくる座標をsceneに入れる

あんまプログラムできない人向けの組み込み関数みたいなの→ファイル書かせて、前にファイルを結合したい  複数requireはある。

